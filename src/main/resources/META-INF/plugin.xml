<idea-plugin>
    <id>com.jirasmartcommit</id>
    <name>JIRA Smart Commit</name>
    <version>1.4.0</version>
    <vendor email="support@jirasmartcommit.com" url="https://github.com/ekosalemba/jira-smart-commit">JIRA Smart Commit</vendor>

    <description><![CDATA[
        <p>Generate intelligent commit messages and PR descriptions using AI with JIRA integration.</p>

        <h3>Features:</h3>
        <ul>
            <li><b>AI-Powered Commit Messages</b> - Generate conventional commit messages based on staged changes and JIRA ticket context</li>
            <li><b>File Selection Dialog</b> - Choose which files to include in the commit with an intuitive checkbox interface</li>
            <li><b>JIRA Integration</b> - Automatically fetch ticket details from branch name</li>
            <li><b>PR Title & Description Generation</b> - Create comprehensive PR titles and descriptions from commit history</li>
            <li><b>Create PR with One Click</b> - Open PR creation page with auto-filled title and description (GitHub, GitLab, Bitbucket)</li>
            <li><b>Automatic PR Creation via API</b> - Create PRs directly via platform APIs without leaving the IDE (Bitbucket, GitHub, GitLab)</li>
            <li><b>PR Reviewers Selection</b> - Select reviewers from repository members with default reviewers pre-selected</li>
            <li><b>Smart Branch Creation</b> - Create branches from JIRA tickets with auto-generated names</li>
            <li><b>Multiple AI Providers</b> - Support for OpenAI (GPT-4) and Anthropic (Claude)</li>
        </ul>

        <h3>Usage:</h3>
        <ol>
            <li>Configure JIRA and AI credentials in Settings → Tools → JIRA Smart Commit</li>
            <li>Make changes to your code</li>
            <li>Use Git → JIRA Smart Commit → Generate Commit Message (Ctrl+Alt+G)</li>
            <li>Select which files to include in the file selection dialog</li>
            <li>Review and edit the generated message</li>
            <li>Commit!</li>
        </ol>
    ]]></description>

    <change-notes><![CDATA[
        <h3>1.4.0</h3>
        <ul>
            <li><b>New:</b> PR Reviewers Selection - Select reviewers when creating PR via API</li>
            <li><b>New:</b> Default Reviewers - Pre-select default reviewers from Bitbucket config</li>
            <li><b>New:</b> Repository Permissions - Fetch all reviewers with admin token (Bitbucket)</li>
            <li><b>New:</b> Multi-platform Reviewers - Support for Bitbucket, GitHub, and GitLab</li>
            <li><b>Improved:</b> PR Dialog UI - Side-by-side layout for description and reviewers</li>
        </ul>

        <h3>1.3.0</h3>
        <ul>
            <li><b>New:</b> Automatic PR Creation via API - Create PRs directly without leaving the IDE</li>
            <li><b>New:</b> Git Platform Token setting - Configure access tokens for Bitbucket, GitHub, and GitLab</li>
            <li><b>New:</b> Multi-platform API support - Works with Bitbucket REST API 2.0, GitHub REST API, and GitLab API</li>
            <li><b>Improved:</b> Bitbucket workflow - No more manual copy-paste when token is configured</li>
            <li><b>Improved:</b> Smart fallback - Falls back to browser-based flow if API fails</li>
        </ul>

        <h3>1.2.0</h3>
        <ul>
            <li><b>New:</b> File Selection Dialog - Choose which files to include in commit before generating message</li>
            <li><b>New:</b> Stage/Unstage from dialog - Toggle files to stage or unstage directly from the selection dialog</li>
            <li><b>New:</b> Untracked file support - View and stage untracked files in the selection dialog</li>
            <li><b>Improved:</b> Better workflow - No need to manually stage files before triggering commit generation</li>
        </ul>

        <h3>1.1.0</h3>
        <ul>
            <li><b>New:</b> PR Title generation - AI now generates both title and description</li>
            <li><b>New:</b> Create PR button - Opens browser with auto-filled PR form</li>
            <li><b>New:</b> Base branch selector - Choose target branch for PRs</li>
            <li><b>New:</b> Platform support - GitHub, GitLab, and Bitbucket</li>
            <li><b>Improved:</b> Bitbucket support - Copies content to clipboard when creating PR</li>
        </ul>

        <h3>1.0.0</h3>
        <ul>
            <li>Initial release</li>
            <li>JIRA ticket integration</li>
            <li>AI-powered commit message generation</li>
            <li>PR description generation</li>
            <li>Smart branch creation from JIRA tickets</li>
            <li>Support for OpenAI and Anthropic</li>
        </ul>
    ]]></change-notes>

    <depends>com.intellij.modules.platform</depends>
    <depends>Git4Idea</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Application-level settings service -->
        <applicationService
            serviceImplementation="com.jirasmartcommit.settings.PluginSettings"/>

        <!-- Settings configurable -->
        <applicationConfigurable
            parentId="tools"
            instance="com.jirasmartcommit.settings.PluginSettingsConfigurable"
            id="com.jirasmartcommit.settings.PluginSettingsConfigurable"
            displayName="JIRA Smart Commit"/>

        <!-- Project-level services -->
        <projectService
            serviceImplementation="com.jirasmartcommit.services.JiraService"/>
        <projectService
            serviceImplementation="com.jirasmartcommit.services.AIService"/>
        <projectService
            serviceImplementation="com.jirasmartcommit.services.GitService"/>
        <projectService
            serviceImplementation="com.jirasmartcommit.services.PullRequestService"/>

        <!-- Notifications -->
        <notificationGroup
            id="JIRA Smart Commit"
            displayType="BALLOON"
            toolWindowId="Version Control"/>
    </extensions>

    <actions>
        <!-- Main action group -->
        <group id="JiraSmartCommit.MainGroup"
               text="JIRA Smart Commit"
               description="JIRA Smart Commit actions"
               popup="true">

            <add-to-group group-id="Git.MainMenu" anchor="last"/>

            <action id="JiraSmartCommit.GenerateCommit"
                    class="com.jirasmartcommit.actions.GenerateCommitAction"
                    text="Generate Commit Message"
                    description="Generate a commit message using AI and JIRA context"
                    icon="AllIcons.Vcs.CommitNode">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt G"/>
            </action>

            <action id="JiraSmartCommit.GeneratePRDescription"
                    class="com.jirasmartcommit.actions.GeneratePRDescriptionAction"
                    text="Generate PR Description"
                    description="Generate a PR description from commits"
                    icon="AllIcons.Vcs.Merge">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt P"/>
            </action>

            <separator/>

            <action id="JiraSmartCommit.FetchJiraTicket"
                    class="com.jirasmartcommit.actions.FetchJiraTicketAction"
                    text="Fetch JIRA Ticket"
                    description="Fetch JIRA ticket details from branch name"
                    icon="AllIcons.Actions.Download">
            </action>

            <separator/>

            <action id="JiraSmartCommit.CreateBranch"
                    class="com.jirasmartcommit.actions.CreateBranchAction"
                    text="Create Branch from JIRA Ticket"
                    description="Create a Git branch named after a JIRA ticket"
                    icon="AllIcons.Vcs.Branch">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt B"/>
            </action>
        </group>

        <!-- Context menu in Git tool window -->
        <group id="JiraSmartCommit.ContextGroup">
            <add-to-group group-id="Git.LogContextMenu" anchor="last"/>
            <separator/>
            <reference ref="JiraSmartCommit.GeneratePRDescription"/>
        </group>
    </actions>
</idea-plugin>
